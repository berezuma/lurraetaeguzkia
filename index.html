<!DOCTYPE html>
<html lang="eu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordu Eremuen Arbel Interaktiboa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo pertsonalizatua scrollbar-erako */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 10px;
            border: 2px solid #2d3748;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <main class="w-full max-w-4xl mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8">
        
        <!-- Izenburua -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400">Ordu Eremuen Arbel Interaktiboa</h1>
            <p class="text-gray-400 mt-2">Aukeratu eta gehitu munduko ordu-eremuak denbora errealean ikusteko.</p>
        </header>

        <!-- Kontrol panela: Ordu-eremua gehitzeko -->
        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <div class="relative flex-grow">
                <select id="timezone-select" class="w-full bg-gray-700 border-2 border-gray-600 text-white rounded-lg px-4 py-3 appearance-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                    <!-- Ordu-eremuak hemen kargatuko dira JavaScript bidez -->
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>
            <button id="add-timezone-btn" class="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-3 px-6 rounded-lg transition-transform duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-cyan-500">
                Gehitu Erlojua
            </button>
        </div>

        <!-- Erlojuen edukiontzia -->
        <div id="clocks-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 custom-scrollbar max-h-[50vh] overflow-y-auto pr-2">
            <!-- Erlojuak dinamikoki gehituko dira hemen -->
        </div>

        <!-- Errore mezua -->
        <div id="error-message" class="hidden mt-4 text-center bg-red-900/50 border border-red-500 text-red-300 px-4 py-3 rounded-lg">
            Mezua hemen agertuko da.
        </div>
        
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const timezoneSelect = document.getElementById('timezone-select');
            const addBtn = document.getElementById('add-timezone-btn');
            const clocksContainer = document.getElementById('clocks-container');
            const errorMessage = document.getElementById('error-message');

            let displayedTimezones = new Set();

            // Ordu-eremu ohikoenen koordenatuen mapa
            const timezoneCoordinates = {
                "Europe/Madrid": { lat: 40.4168, lng: -3.7038 },
                "Europe/London": { lat: 51.5074, lng: -0.1278 },
                "Europe/Paris": { lat: 48.8566, lng: 2.3522 },
                "Europe/Berlin": { lat: 52.5200, lng: 13.4050 },
                "America/New_York": { lat: 40.7128, lng: -74.0060 },
                "America/Los_Angeles": { lat: 34.0522, lng: -118.2437 },
                "America/Chicago": { lat: 41.8781, lng: -87.6298 },
                "America/Denver": { lat: 39.7392, lng: -104.9903 },
                "Asia/Tokyo": { lat: 35.6895, lng: 139.6917 },
                "Asia/Dubai": { lat: 25.276987, lng: 55.296249 },
                "Asia/Kolkata": { lat: 22.5726, lng: 88.3639 },
                "Australia/Sydney": { lat: -33.8688, lng: 151.2093 },
                "Africa/Cairo": { lat: 30.0444, lng: 31.2357 },
                "Africa/Johannesburg": { lat: -26.2041, lng: 28.0473 },
                "Pacific/Auckland": { lat: -36.8485, lng: 174.7633 }
            };

            function getCoordinatesForTimezone(timezone) {
                if (timezoneCoordinates[timezone]) {
                    return timezoneCoordinates[timezone];
                }
                // Fallback sinple bat: eremu nagusia bilatu
                const mainRegion = timezone.split('/')[0];
                const similarTimezone = Object.keys(timezoneCoordinates).find(tz => tz.startsWith(mainRegion));
                return similarTimezone ? timezoneCoordinates[similarTimezone] : null;
            }

            // 1. Lortu eta kargatu ordu-eremuen zerrenda
            function populateTimezones() {
                try {
                    const timezones = Intl.supportedValuesOf('timeZone');
                    timezones.forEach(tz => {
                        const option = document.createElement('option');
                        option.value = tz;
                        option.textContent = tz.replace(/_/g, ' ').split('/').join(' / ');
                        timezoneSelect.appendChild(option);
                    });
                    const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    timezoneSelect.value = userTimezone;
                    addClock(userTimezone);
                } catch (e) {
                    console.error("Ezin izan dira ordu-eremuak kargatu:", e);
                    showError("Ezin izan da ordu-eremuen zerrenda lortu.");
                }
            }
            
            // 2. Errore mezuak erakusteko funtzioa
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
                setTimeout(() => {
                    errorMessage.classList.add('hidden');
                }, 3000);
            }

            // 3. Erloju berri bat gehitzeko funtzioa (orain asinkronoa)
            async function addClock(timezone) {
                if (displayedTimezones.has(timezone)) {
                    showError(`'${timezone.replace(/_/g, ' ')}' erlojua jada gehituta dago.`);
                    return;
                }

                displayedTimezones.add(timezone);

                const clockWrapper = document.createElement('div');
                clockWrapper.className = 'bg-gray-700/50 p-5 rounded-xl shadow-lg flex flex-col items-center justify-center gap-2 border border-gray-600 transition-all duration-300 hover:border-cyan-500 hover:shadow-cyan-500/10';
                clockWrapper.dataset.timezone = timezone;

                const timezoneName = timezone.split('/').pop().replace(/_/g, ' ');
                const timezoneRegion = timezone.split('/')[0].replace(/_/g, ' ');

                clockWrapper.innerHTML = `
                    <div class="text-center">
                        <h2 class="text-xl font-semibold text-white">${timezoneName}</h2>
                        <p class="text-sm text-gray-400">${timezoneRegion}</p>
                    </div>
                    <p class="time-display text-4xl font-mono tracking-wider text-cyan-300">--:--:--</p>
                    <div class="sunrise-info flex items-center justify-center gap-2 text-gray-400 text-sm mt-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M7.646 1.146a.5.5 0 0 1 .708 0l1.5 1.5a.5.5 0 0 1-.708.708L8.5 2.707V4.5a.5.5 0 0 1-1 0V2.707l-.646.647a.5.5 0 1 1-.708-.708zM16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M1 8a7 7 0 0 0 1.555 4.512l.41-.71a.5.5 0 0 1 .866.5l-.41.71A7 7 0 0 0 8 15a7 7 0 0 0 4.589-1.99l-.41-.71a.5.5 0 1 1 .866-.5l.41.71A7 7 0 0 0 15 8a7 7 0 0 0-1.555-4.512l-.41.71a.5.5 0 1 1-.866-.5l.41-.71A7 7 0 0 0 8 1a7 7 0 0 0-4.589 1.99l.41.71a.5.5 0 1 1-.866.5l-.41-.71A7 7 0 0 0 1 8m12.5 0a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M4.5 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5"/></svg>
                        <span class="sunrise-time">Lortzen...</span>
                    </div>
                    <button class="remove-btn mt-3 bg-red-500/80 hover:bg-red-600 text-white text-xs font-bold py-1 px-3 rounded-full transition-transform duration-200 transform hover:scale-110">
                        Kendu
                    </button>
                `;

                clocksContainer.appendChild(clockWrapper);

                clockWrapper.querySelector('.remove-btn').addEventListener('click', () => {
                    displayedTimezones.delete(timezone);
                    clockWrapper.remove();
                });

                // Lortu eta erakutsi egunsentiaren ordua
                const sunriseSpan = clockWrapper.querySelector('.sunrise-time');
                const coords = getCoordinatesForTimezone(timezone);

                if (coords) {
                    try {
                        const response = await fetch(`https://api.sunrise-sunset.org/json?lat=${coords.lat}&lng=${coords.lng}&formatted=0`);
                        if (!response.ok) throw new Error('API response not OK');
                        const data = await response.json();
                        
                        if (data.status === 'OK') {
                            const sunriseUTC = new Date(data.results.sunrise);
                            const sunriseLocalTime = sunriseUTC.toLocaleTimeString('eu-ES', {
                                timeZone: timezone,
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            sunriseSpan.textContent = sunriseLocalTime;
                        } else {
                            throw new Error('API status not OK');
                        }
                    } catch (error) {
                        console.error("Ezin izan da egunsentia lortu:", error);
                        sunriseSpan.textContent = "Ezin da lortu";
                        sunriseSpan.previousElementSibling.style.display = 'none'; // Ezkutatu ikonoa
                    }
                } else {
                    sunriseSpan.textContent = "Kokapen ezezaguna";
                    sunriseSpan.previousElementSibling.style.display = 'none'; // Ezkutatu ikonoa
                }
            }

            // 4. Erloju guztiak eguneratzeko funtzioa
            function updateClocks() {
                document.querySelectorAll('.time-display').forEach(timeDisplay => {
                    const clockWrapper = timeDisplay.closest('[data-timezone]');
                    if (clockWrapper) {
                        const timezone = clockWrapper.dataset.timezone;
                        try {
                            const now = new Date();
                            const timeString = now.toLocaleTimeString('eu-ES', {
                                timeZone: timezone,
                                hour: '2-digit',
                                minute: '2-digit',
                                second: '2-digit',
                                hour12: false
                            });
                            timeDisplay.textContent = timeString;
                        } catch (e) {
                            console.error(`Errorea ordua lortzean ${timezone}-rako:`, e);
                            timeDisplay.textContent = "Errorea";
                            displayedTimezones.delete(timezone);
                            clockWrapper.remove();
                            showError(`Errorea '${timezone}' ordu-eremuarekin. Kendu da.`);
                        }
                    }
                });
            }

            // 5. Gehitu botoiaren event listener-a
            addBtn.addEventListener('click', () => {
                const selectedTimezone = timezoneSelect.value;
                addClock(selectedTimezone);
            });

            // 6. Hasieraketa
            populateTimezones();
            setInterval(updateClocks, 1000);
        });
    </script>
</body>
</html>