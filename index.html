<!DOCTYPE html>
<html lang="eu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lurra-Eguzkia Simulagailua</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SunCalc.js liburutegia gehituta -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/"
        }
    }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #111827;
            color: #e5e7eb;
            overflow: hidden;
        }
        /* Pantaila txikietan, canvas-ak altuera finkoa izango du */
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        @media (max-width: 768px) {
            body {
                overflow: auto; /* Scroll ahalbidetu mugikorrean */
            }
            #main-container {
                flex-direction: column;
            }
            #info-panel {
                position: static;
                max-width: 100%;
                border-radius: 0;
                border: 0;
                border-bottom: 1px solid #374151;
            }
            #canvas-container {
                height: 60vh; /* Simulazioari altuera eman mugikorrean */
            }
        }
        
        .slider-container {
            margin-bottom: 1rem;
        }
        .slider-container label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #1f2739;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #1f2739;
        }
        .info-display {
            background-color: #1f2937;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: 600;
            color: #d1d5db;
        }
        .autocomplete-item {
            padding: 0.5rem;
            cursor: pointer;
        }
        .autocomplete-item:hover {
            background-color: #374151;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="main-container" class="relative flex w-full h-full">
        <!-- Kontrol panela -->
        <div id="info-panel" class="md:absolute md:top-5 md:left-5 md:max-w-sm w-full z-10 bg-gray-900/80 md:backdrop-blur-sm md:border md:border-gray-700 md:rounded-lg p-4">
            <h1 class="text-xl font-bold mb-4 text-white">Lurra-Eguzkia Simulagailua</h1>
            
            <div class="mb-4 relative" id="search-container">
                <label for="city-search" class="block mb-2 font-medium">Bilatu hiria</label>
                <div class="flex">
                    <input type="text" id="city-search" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-l-md focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="adib. Bilbao" autocomplete="off">
                    <button id="search-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r-md">Bilatu</button>
                </div>
                <div id="autocomplete-results" class="absolute z-10 w-full bg-gray-800 border border-gray-600 rounded-md mt-1 hidden max-h-48 overflow-y-auto"></div>
                <p id="search-error" class="text-red-400 text-xs mt-1 hidden">Hiria ez da aurkitu.</p>
            </div>
            
            <div class="slider-container">
                <label for="day-slider">Urteko eguna</label>
                <input type="range" id="day-slider" min="1" max="365" value="169">
                <div id="day-display" class="info-display mt-2"></div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="slider-container">
                    <label for="latitude-slider">Latitudea</label>
                    <input type="range" id="latitude-slider" min="-90" max="90" value="43" step="0.1">
                    <div id="latitude-display" class="info-display mt-2"></div>
                </div>
                <div class="slider-container">
                    <label for="longitude-slider">Longitudea</label>
                    <input type="range" id="longitude-slider" min="-180" max="180" value="-3" step="0.1">
                    <div id="longitude-display" class="info-display mt-2"></div>
                </div>
            </div>

            <div class="mt-2">
                <div id="season-display" class="info-display text-lg"></div>
            </div>

            <div class="mt-4 pt-4 border-t border-gray-700">
                <div class="grid grid-cols-3 gap-2 text-center">
                    <div>
                        <p class="text-xs text-gray-400 mb-1">Egunsentia</p>
                        <div id="sunrise-display" class="info-display text-sm py-1">--:--</div>
                    </div>
                    <div>
                        <p class="text-xs text-gray-400 mb-1">Ilunabarra</p>
                        <div id="sunset-display" class="info-display text-sm py-1">--:--</div>
                    </div>
                    <div>
                        <p class="text-xs text-gray-400 mb-1">Iraupena</p>
                        <div id="duration-display" class="info-display text-sm py-1">--h --m</div>
                    </div>
                </div>
                <div id="polar-status-display" class="info-display mt-2 text-sm hidden bg-blue-900/50"></div>
                <p class="text-xs text-gray-500 mt-2 text-center">Oharra: Orduak tokiko eguzki-orduan daude, udako ordutegia kontuan hartu gabe.</p>
            </div>
        </div>

        <!-- 3D Simulazioaren edukiontzia -->
        <div id="canvas-container" class="flex-grow"></div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        
        const canvasContainer = document.getElementById('canvas-container');

        // --- OINARRIZKO KONFIGURAZIOA ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        canvasContainer.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2.5;
        controls.maxDistance = 10;

        // --- ARGIZTAPENA ---
        const sunLight = new THREE.DirectionalLight(0xffffff, 3);
        scene.add(sunLight);
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
        scene.add(ambientLight);

        // --- LURRAREN OBJEKTUAK ---
        const earthGroup = new THREE.Group();
        const EARTH_RADIUS = 1.5;
        const AXIAL_TILT = 23.44 * (Math.PI / 180);

        const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS, 64, 64);
        const earthMaterial = new THREE.MeshStandardMaterial({
            map: new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/land_ocean_ice_cloud_2048.jpg', 
                (texture) => { texture.colorSpace = THREE.SRGBColorSpace; },
                undefined,
                (err) => {
                    console.error('An error happened loading the texture.');
                    earthMaterial.map = null;
                    earthMaterial.color.set(0x2266dd);
                    earthMaterial.needsUpdate = true;
                }
            ),
            metalness: 0.2,
            roughness: 0.8
        });
        const earth = new THREE.Mesh(earthGeometry, earthMaterial);
        
        earth.rotation.y = -Math.PI / 2;
        earthGroup.add(earth);

        const axisMaterial = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 2 });
        const axisPoints = [new THREE.Vector3(0, -EARTH_RADIUS * 1.5, 0), new THREE.Vector3(0, EARTH_RADIUS * 1.5, 0)];
        const axisGeometry = new THREE.BufferGeometry().setFromPoints(axisPoints);
        const axisLine = new THREE.Line(axisGeometry, axisMaterial);
        earthGroup.add(axisLine);

        function createCircleLine(radius, color) {
            const points = [];
            for (let i = 0; i <= 128; i++) {
                const theta = (i / 128) * Math.PI * 2;
                points.push(new THREE.Vector3(Math.cos(theta) * radius, 0, Math.sin(theta) * radius));
            }
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const material = new THREE.LineBasicMaterial({ color: color });
            return new THREE.Line(geometry, material);
        }

        const equator = createCircleLine(EARTH_RADIUS, 0xffff00);
        earthGroup.add(equator);
        const tropicOfCancer = createCircleLine(EARTH_RADIUS * Math.cos(AXIAL_TILT), 0xffa500);
        tropicOfCancer.position.y = EARTH_RADIUS * Math.sin(AXIAL_TILT);
        earthGroup.add(tropicOfCancer);
        const tropicOfCapricorn = createCircleLine(EARTH_RADIUS * Math.cos(AXIAL_TILT), 0xffa500);
        tropicOfCapricorn.position.y = -EARTH_RADIUS * Math.sin(AXIAL_TILT);
        earthGroup.add(tropicOfCapricorn);

        const markerGeometry = new THREE.SphereGeometry(0.05, 16, 16);
        const markerMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        const latitudeMarker = new THREE.Mesh(markerGeometry, markerMaterial);
        earthGroup.add(latitudeMarker);
        
        earthGroup.rotation.z = -AXIAL_TILT;
        scene.add(earthGroup);

        // --- KONTROLEN LOGIKA ---
        const daySlider = document.getElementById('day-slider');
        const latitudeSlider = document.getElementById('latitude-slider');
        const longitudeSlider = document.getElementById('longitude-slider');
        const dayDisplay = document.getElementById('day-display');
        const latitudeDisplay = document.getElementById('latitude-display');
        const longitudeDisplay = document.getElementById('longitude-display');
        const seasonDisplay = document.getElementById('season-display');
        const sunriseDisplay = document.getElementById('sunrise-display');
        const sunsetDisplay = document.getElementById('sunset-display');
        const durationDisplay = document.getElementById('duration-display');
        const polarStatusDisplay = document.getElementById('polar-status-display');
        const citySearchInput = document.getElementById('city-search');
        const searchButton = document.getElementById('search-button');
        const searchError = document.getElementById('search-error');
        const autocompleteResults = document.getElementById('autocomplete-results');
        const searchContainer = document.getElementById('search-container');

        function getDateFromDay(dayOfYear) {
            const date = new Date(new Date().getFullYear(), 0); 
            return new Date(date.setDate(dayOfYear));
        }

        function updateSimulation() {
            const dayOfYear = parseInt(daySlider.value);
            const latitude = parseFloat(latitudeSlider.value);
            const longitude = parseFloat(longitudeSlider.value);
            const date = getDateFromDay(dayOfYear);

            // 1. Eguzkiaren posizioa eguneratu
            const sunDeclination = -AXIAL_TILT * Math.cos((2 * Math.PI / 365) * (dayOfYear + 10));
            const sunX = 10 * Math.sin(sunDeclination);
            const sunY = 10 * Math.cos(sunDeclination);
            sunLight.position.set(0, sunX, sunY);

            // 2. Markatzailea eguneratu
            const latRad = latitude * (Math.PI / 180);
            const lonRad = longitude * (Math.PI / 180);
            latitudeMarker.position.set(
                EARTH_RADIUS * Math.cos(latRad) * Math.sin(lonRad),
                EARTH_RADIUS * Math.sin(latRad),
                EARTH_RADIUS * Math.cos(latRad) * Math.cos(lonRad)
            );

            // 3. Interfazeko testuak eguneratu
            dayDisplay.textContent = `${dayOfYear}. eguna (${date.toLocaleDateString('eu-ES', { month: 'long', day: 'numeric' })})`;
            latitudeDisplay.textContent = `${Math.abs(latitude).toFixed(2)}º ${latitude >= 0 ? 'I' : 'H'}`;
            longitudeDisplay.textContent = `${Math.abs(longitude).toFixed(2)}º ${longitude >= 0 ? 'E' : 'M'}`;

            // 4. Urtaroa zehaztu
            let season = '';
            if (latitude >= 0) {
                if (dayOfYear >= 80 && dayOfYear < 172) season = 'Udaberria';
                else if (dayOfYear >= 172 && dayOfYear < 264) season = 'Uda';
                else if (dayOfYear >= 264 && dayOfYear < 355) season = 'Udazkena';
                else season = 'Negua';
            } else {
                if (dayOfYear >= 80 && dayOfYear < 172) season = 'Udazkena';
                else if (dayOfYear >= 172 && dayOfYear < 264) season = 'Negua';
                else if (dayOfYear >= 264 && dayOfYear < 355) season = 'Udaberria';
                else season = 'Uda';
            }
            seasonDisplay.textContent = season;

            // 5. Egunaren iraupena kalkulatu (TOKIKO ORDUAREKIN ZUZENDUTA)
            const times = SunCalc.getTimes(date, latitude, longitude);
            const sunrise = times.sunrise;
            const sunset = times.sunset;
            
            polarStatusDisplay.classList.add('hidden');

            if (sunrise instanceof Date && !isNaN(sunrise) && sunset instanceof Date && !isNaN(sunset)) {
                // Longitudean oinarritutako ordu-desberdintasuna kalkulatu
                const offsetHours = longitude / 15;

                const formatTimeFromDecimal = (decimalHours) => {
                    const correctedHours = (decimalHours + 24) % 24;
                    const h = Math.floor(correctedHours);
                    const m = Math.round((correctedHours - h) * 60);
                    return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                };

                const sunriseUTCDecimal = sunrise.getUTCHours() + sunrise.getUTCMinutes() / 60;
                const sunsetUTCDecimal = sunset.getUTCHours() + sunset.getUTCMinutes() / 60;

                const sunriseLocalDecimal = sunriseUTCDecimal + offsetHours;
                const sunsetLocalDecimal = sunsetUTCDecimal + offsetHours;

                sunriseDisplay.textContent = formatTimeFromDecimal(sunriseLocalDecimal);
                sunsetDisplay.textContent = formatTimeFromDecimal(sunsetLocalDecimal);

                const durationMs = sunset.getTime() - sunrise.getTime();
                const durationHours = Math.floor(durationMs / 3600000);
                const durationMinutes = Math.floor((durationMs % 3600000) / 60000);
                durationDisplay.textContent = `${durationHours}h ${durationMinutes}m`;

            } else {
                sunriseDisplay.textContent = "--:--";
                sunsetDisplay.textContent = "--:--";
                const sunPos = SunCalc.getPosition(date, latitude, longitude);
                if (sunPos.altitude > 0) {
                    durationDisplay.textContent = "24h 0m";
                    polarStatusDisplay.textContent = "24 orduko eguna (gauerdiko eguzkia)";
                    polarStatusDisplay.classList.remove('hidden');
                } else {
                    durationDisplay.textContent = "0h 0m";
                    polarStatusDisplay.textContent = "24 orduko gaua (gau polarra)";
                    polarStatusDisplay.classList.remove('hidden');
                }
            }
        }

        // --- HIRI BILATZAILEAREN FUNTZIOA ---
        async function searchCity(cityName) {
            if (!cityName) return;

            searchButton.textContent = 'Bilatzen...';
            searchButton.disabled = true;
            searchError.classList.add('hidden');

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(cityName)}&format=json&limit=1`);
                const data = await response.json();

                if (data && data.length > 0) {
                    const city = data[0];
                    latitudeSlider.value = parseFloat(city.lat);
                    longitudeSlider.value = parseFloat(city.lon);
                    updateSimulation();
                } else {
                    searchError.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Errorea hiria bilatzean:", error);
                searchError.textContent = "Errore bat gertatu da bilatzean.";
                searchError.classList.remove('hidden');
            } finally {
                searchButton.textContent = 'Bilatu';
                searchButton.disabled = false;
            }
        }

        // --- AUTOCOMPLETE LOGIKA (EUSKAL HERRIKO IZENEKIN EGOKITUTA) ---
        const iparraldeTowns = {
            'Lapurdi': ['Ahetze', 'Ahurti', 'Ainhoa', 'Angelu', 'Arbona', 'Arrangoitze', 'Azkaine', 'Baiona', 'Bardoze', 'Basusarri', 'Beskoitze', 'Biarritz', 'Bidarte', 'Biriatu', 'Bokale', 'Donibane Lohizune', 'Ezpeleta', 'Getaria', 'Gixune', 'Haltsu', 'Hazparne', 'Hendaia', 'Hiriburu', 'Itsasu', 'Jatsu', 'Kanbo', 'Larresoro', 'Lehuntze', 'Lekorne', 'Lekuine', 'Luhuso', 'Makea', 'Milafranga', 'Mugerre', 'Sara', 'Senpere', 'Urketa', 'Urruña', 'Uztaritze', 'Ziburu', 'Zuraide'],
            'Nafarroa Beherea': ['Ahatsa-Altzieta-Bazkazane', 'Aiherra', 'Ainhize-Monjolose', 'Aintzila', 'Aiziritze-Gamue-Zohazti', 'Akamarre', 'Aldude', 'Amenduze-Unaso', 'Amorotze-Zokotze', 'Anhauze', 'Arberatze-Zilhekoa', 'Arboti-Zohota', 'Arhantsusi', 'Armendaritze', 'Arnegi', 'Arrosa', 'Arrueta-Sarrikota', 'Azkarate', 'Baigorri', 'Banka', 'Bastida', 'Behaskane-Laphizketa', 'Behauze', 'Behorlegi', 'Bidarrai', 'Bidaxune', 'Bithirina', 'Bunuze', 'Burgue-Erreiti', 'Buztintze-Hiriberri', 'Donaixti-Ibarre', 'Donamartiri', 'Donapaleu', 'Donazaharre', 'Donibane Garazi', 'Donoztiri', 'Duzunaritze-Sarasketa', 'Eiheralarre', 'Erango', 'Ezterenzubi', 'Gabadi', 'Gamarte', 'Garrüze', 'Heleta', 'Hozta', 'Ibarla', 'Iholdi', 'Ilharre', 'Irisarri', 'Irulegi', 'Izpura', 'Izturitze', 'Izura-Azme', 'Jatsu Garazi', 'Jutsi', 'Labetze-Bizkai', 'Lakarra', 'Landibarre', 'Larribarre-Sorhapürü', 'Larzabale-Arroze-Zibitze', 'Lasa', 'Lekunberri', 'Lüküze-Altzümarta', 'Martxueta', 'Mehaine', 'Mendibe', 'Oragarre', 'Ortzaize', 'Ostankoa', 'Pagola', 'Suhuskune', 'Uharte Garazi', 'Uhartehiri', 'Urepele', 'Zaro'],
            'Zuberoa': ['Ainharbe', 'Aloze-Ziboze-Onizegaine', 'Altzai-Altzabeheti-Zunharreta', 'Altzürükü', 'Arrokiaga', 'Arüe-Ithorrotze-Olhaibi', 'Atharratze-Sorholüze', 'Barkoxe', 'Berrogaine-Lahüntze', 'Bildoze-Onizepea', 'Domintxaine-Berroeta', 'Eskiula', 'Etxarri', 'Etxebarre', 'Espeize-Undüreine', 'Gamere-Zihiga', 'Garindaine', 'Gotaine-Irabarne', 'Hauze', 'Idauze-Mendi', 'Iruri', 'Jestaze', 'Lakarri-Arhane-Sarrikotagaine', 'Larraine', 'Lexantzü-Zünharre', 'Ligi-Atherei', 'Liginaga-Astüe', 'Lohitzüne-Oihergi', 'Maule-Lextarre', 'Mendikota', 'Mitikile-Larrori-Mendibile', 'Montori', 'Muskildi', 'Ospitalepea', 'Ozaraine-Erribareita', 'Ozaze-Zühara', 'Santa-Grazi', 'Sarrikotapea', 'Sohüta', 'Urdiñarbe', 'Urrüstoi-Larrabile', 'Zalgize-Doneztebe']
        };
        const hegoaldeProvinces = {
            'Bizkaia': ['Bizkaia', 'Biscay'],
            'Gipuzkoa': ['Gipuzkoa', 'Guipúzcoa'],
            'Araba': ['Araba', 'Álava'],
            'Nafarroa': ['Nafarroa', 'Navarra', 'Comunidad Foral de Navarra']
        };
        const generalBasqueKeywords = ['Euskadi', 'País Vasco', 'Basque Country'];
        
        function formatBasqueDisplayName(place) {
            const displayName = place.display_name;
            const townName = displayName.split(',')[0].trim();
            let province = null;

            // 1. Egiaztatu Hegoaldeko herria den
            for (const [p, names] of Object.entries(hegoaldeProvinces)) {
                if (names.some(name => displayName.includes(name))) {
                    province = p;
                    break;
                }
            }
            if (!province && generalBasqueKeywords.some(keyword => displayName.includes(keyword))) {
                 province = displayName.split(',')[1]?.trim() || '';
            }
            if (province) {
                return `${townName}, ${province}, Euskal Herria`;
            }

            // 2. Egiaztatu Iparraldeko herria den, "Pyrénées-Atlantiques" baldintza gehituz
            if (displayName.includes('Pyrénées-Atlantiques') || displayName.includes('Pirinio Atlantikoak')) {
                for (const [p, towns] of Object.entries(iparraldeTowns)) {
                    if (towns.map(t => t.toLowerCase()).includes(townName.toLowerCase())) {
                        province = p;
                        return `${townName}, ${province}, Euskal Herria`;
                    }
                }
            }
            
            // 3. Bestela, itzuli jatorrizko izena
            return displayName;
        }

        let autocompleteTimeout;
        citySearchInput.addEventListener('input', () => {
            clearTimeout(autocompleteTimeout);
            const query = citySearchInput.value;
            
            if (query.length < 3) {
                autocompleteResults.classList.add('hidden');
                return;
            }

            autocompleteTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=5&addressdetails=1&accept-language=eu,en`);
                    const data = await response.json();
                    
                    autocompleteResults.innerHTML = '';
                    if (data && data.length > 0) {
                        data.forEach(place => {
                            const item = document.createElement('div');
                            item.className = 'autocomplete-item';
                            item.textContent = formatBasqueDisplayName(place);
                            item.addEventListener('click', () => {
                                citySearchInput.value = place.display_name.split(',')[0];
                                latitudeSlider.value = parseFloat(place.lat);
                                longitudeSlider.value = parseFloat(place.lon);
                                updateSimulation();
                                autocompleteResults.classList.add('hidden');
                            });
                            autocompleteResults.appendChild(item);
                        });
                        autocompleteResults.classList.remove('hidden');
                    } else {
                        autocompleteResults.classList.add('hidden');
                    }
                } catch (error) {
                    console.error("Autocomplete errorea:", error);
                    autocompleteResults.classList.add('hidden');
                }
            }, 300);
        });

        document.addEventListener('click', (event) => {
            if (!searchContainer.contains(event.target)) {
                autocompleteResults.classList.add('hidden');
            }
        });

        searchButton.addEventListener('click', () => searchCity(citySearchInput.value));
        citySearchInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                autocompleteResults.classList.add('hidden');
                searchCity(citySearchInput.value);
            }
        });

        daySlider.addEventListener('input', updateSimulation);
        latitudeSlider.addEventListener('input', updateSimulation);
        longitudeSlider.addEventListener('input', updateSimulation);

        function animate() {
            requestAnimationFrame(animate);
            earthGroup.rotation.y += 0.002;
            controls.update();
            renderer.render(scene, camera);
        }

        // Leihoaren tamaina aldaketak kudeatu
        function onWindowResize() {
            camera.aspect = canvasContainer.clientWidth / canvasContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
        }
        window.addEventListener('resize', onWindowResize);
        
        // Hasierako deia tamaina ondo ezartzeko
        onWindowResize();
        updateSimulation();
        animate();
    </script>
</body>
</html>